// Materials Cloud bands structure widget v1.1.0
// 2020-06-04, MIT License
function getPathStringFromPathArray(a){var b=[],c="";return a.forEach(function(a){0===b.length?(b+=a[0],b+="-",b+=a[1]):(c!=a[0]&&(b+="|"+a[0]),b+="-",b+=a[1]),c=a[1]}),b}function getPathArrayFromPathString(a){var b=[],c=a.split("|");return c.forEach(function(a){pointsStrings=a.split("-"),pointsTrimmedStrings=pointsStrings.map(function(a){return a.trim()}),points=pointsTrimmedStrings.filter(function(a){return""!==a}),zip(points.slice(0,points.length-1),points.slice(1)).forEach(function(a){b.push([a[0],a[1]])})}),b}function getValidPointNames(a){var b=[];a.forEach(function(a){a.hasOwnProperty("paths")&&a.paths.forEach(function(a){b.push(a.from),b.push(a.to)})});var c=Array.from(new Set(b));return c.sort(),c}function BandPlot(a){this.divID=a,this.allData=[],this.allSeries=[],this.allColorInfo=[],this.currentPath=[],"undefined"!=typeof this.myChart&&this.myChart.destroy()}var zip=function(){var a=[].slice.call(arguments),b=0===a.length?[]:a.reduce(function(a,b){return a.length<b.length?a:b});return b.map(function(b,c){return a.map(function(a){return a[c]})})};BandPlot.prototype.addBandStructure=function(a,b){var c=["#555555","#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"];if("undefined"==typeof b){var d=this.allColorInfo.length,e=tinycolor(c[d%c.length]);b=[e.toHexString(),e.darken(20).toHexString(),e.brighten(20).toHexString()]}this.allColorInfo.push(b),this.allData.push(a)},BandPlot.prototype.initChart=function(){var a={chart:{type:"line",zoomType:"xy"},credits:{enabled:!1},boost:{useGPUTranslations:!0},title:{text:""},xAxis:{tickPositioner:function(){return[]},lineWidth:0},yAxis:{plotLines:[],title:{text:" ",useHTML:!0},endOnTick:!1,alignTicks:!1},tooltip:{formatter:function(a){return"y="+Math.round(100*this.y)/100+"<br>Drag to zoom"}},legend:{enabled:!1},series:this.allSeries,plotOptions:{series:{marker:{states:{select:{fillColor:"red",radius:5,lineWidth:0}}},cursor:"pointer"}}};this.myChart=Highcharts.chart(this.divID,a)},BandPlot.prototype.getDefaultPath=function(){return this.allData.length>0?(currentPathSpecification=this.allData[0].path,currentPathSpecification):[]},BandPlot.prototype.updateBandPlot=function(a,b){var c=this;void 0===b&&(b=!1);var d=.1;"undefined"==typeof a?currentPathSpecification=c.getDefaultPath():currentPathSpecification=a;var e=!1;if(c.currentPath.length!=currentPathSpecification.length?e=!0:zip(c.currentPath,currentPathSpecification).forEach(function(a){a[0][0]!=a[1][0]&&(e=!0),a[0][1]!=a[1][1]&&(e=!0)}),e||b){c.currentPath=currentPathSpecification;var f=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.from==a[0]&&d.to==a[1])return{segment:d,reverse:!1};if(d.from==a[1]&&d.to==a[0])return{segment:d,reverse:!0}}return null},g=0;highSymmetryTicks=[],currentPathSpecification.forEach(function(a,b){0===highSymmetryTicks.length?highSymmetryTicks.push([g,a[0]]):highSymmetryTicks[highSymmetryTicks.length-1][1]!=a[0]&&(highSymmetryTicks[highSymmetryTicks.length-1][1]+="|"+a[0]);var e,h=!1,i=null;c.allData.forEach(function(b,d){var j=f(a,b.paths);if(j){h=!0;var k=[],l=j.segment.x.length;if(j.reverse)for(e=j.segment.x.length-1;e>=0;e--)k.push(j.segment.x[l-1]-j.segment.x[e]);else for(e=0;l>e;e++)k.push(j.segment.x[e]-j.segment.x[0]);twoBandTypes=j.segment.two_band_types||!1,numBands=j.segment.values.length,null===i&&(i=k[k.length-1]);var m=1;if(k[k.length-1]>0)for(m=i/k[k.length-1],e=0;e<k.length;e++)k[e]*=m;i>0&&j.segment.values.forEach(function(b,e){var f,h=[];f=j.reverse?b.slice().reverse():b,zip(k,f).forEach(function(a){h.push([a[0]+g,a[1]])}),colorInfo=c.allColorInfo[d],twoBandTypes?2*e<numBands?lineColor=colorInfo[1]:lineColor=colorInfo[2]:lineColor=colorInfo[0];var i={name:a[0]+"-"+a[1]+"."+e,color:lineColor,marker:{radius:0,symbol:"circle"},data:h};c.allSeries.push(i)})}}),g+=h&&i>0?i:d,highSymmetryTicks.push([g,a[1]])}),c.initChart(),c.updateTicks(highSymmetryTicks),c.myChart.xAxis[0].setExtremes(0,g),Y_label=c.allData[0].Y_label,"undefined"==typeof Y_label&&(Y_label="Bands"),c.myChart.yAxis[0].axisTitle.textSetter(Y_label)}},BandPlot.prototype.updateTicks=function(a){var b,c=this,d=function(a,c){var d={};for(b=0;b<c.length;b++)d[c[b][0]]=c[b][1];var e=function(a){return a=a.replace(/GAMMA/gi,"&Gamma;"),a=a.replace(/DELTA/gi,"&Delta;"),a=a.replace(/SIGMA/gi,"&Sigma;"),a=a.replace(/LAMBDA/gi,"&Lambda;"),a=a.replace(/\-/gi,"&mdash;"),a=a.replace(/_(.)/gi,function(a,b,c,d){return"<sub>"+b+"</sub>"})},f=function(a){return"G"==a&&(a="&Gamma;"),a=a.replace(/\-/gi,"&mdash;"),a=a.replace(/(\d+)/gi,function(a,b,c,d){return"<sub>"+b+"</sub>"})},g=getValidPointNames([a]),h=!1;h=-1!=g.findIndex(function(a){return"GAMMA"==a})?!1:-1!=g.findIndex(function(a){return"G"==a})?!0:!1;var i;return i=h?f:e,function(){return raw_label=d[this.value],"undefined"==typeof raw_label?raw_label:(label=i(raw_label),label)}},e=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c][0]);return function(){var a=[];return b.forEach(function(b){a.push(b)}),a}};for(c.myChart.xAxis[0].removePlotLine(),b=c.myChart.xAxis[0].ticks.length-1;b>=0;b--)c.myChart.xAxis[0].ticks[b].remove();var f=[],g=[];for(b=0;b<a.length;b++)g.push(a[b][0]),f.push({value:a[b][0],color:"#CCCCCC",width:1});c.myChart.xAxis[0].setOptions({plotLines:[],lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0,tickPositioner:e(a),labels:{useHTML:!0,align:"center",style:{fontSize:"16px"}}}),c.myChart.xAxis[0].labelFormatter=d(c.allData,a),c.myChart.xAxis[0].setTickPositions(),ax=c.myChart.xAxis[0],c.myChart.render(),f.forEach(function(a){c.myChart.xAxis[0].addPlotLine(a)})};