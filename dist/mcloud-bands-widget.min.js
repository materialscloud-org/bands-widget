// Materials Cloud bands structure widget v1.1.0
// 2020-05-18, MIT License
function getPathStringFromPathArray(a){var b=[],c="";return a.forEach(function(a){0==b.length?(b+=a[0],b+="-",b+=a[1]):(c!=a[0]&&(b+="|"+a[0]),b+="-",b+=a[1]),c=a[1]}),b}function getPathArrayFromPathString(a){var b=[],c=a.split("|");return c.forEach(function(a){pointsStrings=a.split("-"),pointsTrimmedStrings=pointsStrings.map(function(a){return a.trim()}),points=pointsTrimmedStrings.filter(function(a){return""!=a}),zip(points.slice(0,points.length-1),points.slice(1)).forEach(function(a){b.push([a[0],a[1]])})}),b}function getValidPointNames(a){var b=[];a.forEach(function(a){a.hasOwnProperty("paths")&&a.paths.forEach(function(a){b.push(a.from),b.push(a.to)})});var c=Array.from(new Set(b));return c.sort(),c}function BandPlot(a){this.divID=a,this.allData=[],this.allColorInfo=[],this.currentPath=[],"undefined"!=typeof this.myChart&&this.myChart.destroy(),this.initChart(this.divID)}var zip=function(){var a=[].slice.call(arguments),b=0==a.length?[]:a.reduce(function(a,b){return a.length<b.length?a:b});return b.map(function(b,c){return a.map(function(a){return a[c]})})};BandPlot.prototype.addBandStructure=function(a,b){var c=["#555555","#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"];if("undefined"==typeof b){var d=this.allColorInfo.length,e=tinycolor(c[d%c.length]);b=[e.toHexString(),e.darken(20).toHexString(),e.brighten(20).toHexString()]}this.allColorInfo.push(b),this.allData.push(a)},BandPlot.prototype.initChart=function(a){var b={chart:{type:"line",zoomType:"xy"},credits:{enabled:!1},title:{text:""},xAxis:{tickPositioner:function(){return[]},lineWidth:0},yAxis:{plotLines:[],title:{text:" ",useHTML:!0}},tooltip:{formatter:function(a){return"y="+Math.round(100*this.y)/100+"<br>Drag to zoom"}},legend:{enabled:!1},series:[],plotOptions:{line:{animation:!0},series:{marker:{states:{select:{fillColor:"red",radius:5,lineWidth:0}}},cursor:"pointer"}}};this.myChart=Highcharts.chart(a,b)},BandPlot.prototype.getDefaultPath=function(){return this.allData.length>0?currentPathSpecification=this.allData[0].path:[]},BandPlot.prototype.updateBandPlot=function(a,b){var c=this;void 0==b&&(b=!1);var d=.1;"undefined"==typeof a?currentPathSpecification=c.getDefaultPath():currentPathSpecification=a;var e=!1;if(c.currentPath.length!=currentPathSpecification.length?e=!0:zip(c.currentPath,currentPathSpecification).forEach(function(a){a[0][0]!=a[1][0]&&(e=!0),a[0][1]!=a[1][1]&&(e=!0)}),e||b){c.currentPath=currentPathSpecification;for(var f=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.from==a[0]&&d.to==a[1])return{segment:d,reverse:!1};if(d.from==a[1]&&d.to==a[0])return{segment:d,reverse:!0}}return null},g=c.myChart.series.length-1;g>=0;g--)c.myChart.series[g].remove(redraw=!1);var h=0;highSymmetryTicks=[],currentPathSpecification.forEach(function(a,b){0==highSymmetryTicks.length?highSymmetryTicks.push([h,a[0]]):highSymmetryTicks[highSymmetryTicks.length-1][1]!=a[0]&&(highSymmetryTicks[highSymmetryTicks.length-1][1]+="|"+a[0]);var e=!1,g=null;c.allData.forEach(function(b,d){var i=f(a,b.paths);if(i){e=!0;var j=[],k=i.segment.x.length;if(i.reverse)for(var l=i.segment.x.length-1;l>=0;l--)j.push(i.segment.x[k-1]-i.segment.x[l]);else for(var l=0;k>l;l++)j.push(i.segment.x[l]-i.segment.x[0]);twoBandTypes=i.segment.two_band_types||!1,numBands=i.segment.values.length,null===g&&(g=j[j.length-1]);var m=1;if(j[j.length-1]>0){m=g/j[j.length-1];for(var l=0;l<j.length;l++)j[l]*=m}g>0&&i.segment.values.forEach(function(b,e){var f=[];if(i.reverse)var g=b.slice().reverse();else var g=b;zip(j,g).forEach(function(a){f.push([a[0]+h,a[1]])}),colorInfo=c.allColorInfo[d],twoBandTypes?2*e<numBands?lineColor=colorInfo[1]:lineColor=colorInfo[2]:lineColor=colorInfo[0];var k={name:a[0]+"-"+a[1]+"."+e,color:lineColor,marker:{radius:0,symbol:"circle"},data:f};c.myChart.addSeries(k,redraw=!1)})}}),h+=e&&g>0?g:d,highSymmetryTicks.push([h,a[1]])}),c.myChart.redraw(),c.updateTicks(highSymmetryTicks),c.myChart.xAxis[0].setExtremes(0,h),Y_label=c.allData[0].Y_label,"undefined"==typeof Y_label&&(Y_label="Bands"),c.myChart.yAxis[0].axisTitle.textSetter(Y_label)}},BandPlot.prototype.updateTicks=function(a){var b=this,c=function(a,b){for(var c={},d=0;d<b.length;d++)c[b[d][0]]=b[d][1];var e=function(a){return a=a.replace(/GAMMA/gi,"&Gamma;"),a=a.replace(/DELTA/gi,"&Delta;"),a=a.replace(/SIGMA/gi,"&Sigma;"),a=a.replace(/LAMBDA/gi,"&Lambda;"),a=a.replace(/\-/gi,"&mdash;"),a=a.replace(/_(.)/gi,function(a,b,c,d){return"<sub>"+b+"</sub>"})},f=function(a){return"G"==a&&(a="&Gamma;"),a=a.replace(/\-/gi,"&mdash;"),a=a.replace(/(\d+)/gi,function(a,b,c,d){return"<sub>"+b+"</sub>"})},g=getValidPointNames([a]),h=!1;h=-1!=g.findIndex(function(a){return"GAMMA"==a})?!1:-1!=g.findIndex(function(a){return"G"==a})?!0:!1;var i;return i=h?f:e,function(){return raw_label=c[this.value],"undefined"==typeof raw_label?raw_label:(label=i(raw_label),label)}},d=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c][0]);return function(){var a=[];return b.forEach(function(b){a.push(b)}),a}};b.myChart.xAxis[0].removePlotLine();for(var e=b.myChart.xAxis[0].ticks.length-1;e>=0;e--)b.myChart.xAxis[0].ticks[e].remove();for(var f=[],g=[],e=0;e<a.length;e++)g.push(a[e][0]),f.push({value:a[e][0],color:"#CCCCCC",width:1});b.myChart.xAxis[0].setOptions({plotLines:[],lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0,tickPositioner:d(a),labels:{useHTML:!0,align:"center",style:{fontSize:"16px"}}}),b.myChart.xAxis[0].labelFormatter=c(b.allData,a),b.myChart.xAxis[0].setTickPositions(),ax=b.myChart.xAxis[0],b.myChart.render(),f.forEach(function(a){b.myChart.xAxis[0].addPlotLine(a)})};